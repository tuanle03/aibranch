var l=Object.defineProperty;var n=(e,r)=>l(e,"name",{value:r,configurable:!0});const f="    ",m=n(e=>`

Import trace:
${e.map((r,c)=>`${c===0?f:`${f}\u21B3 `}${r}`).join(`
`)}
`,"formatTrace"),h=n(e=>{typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"&&"importTrace"in e&&Array.isArray(e.importTrace)&&(e.message+=m(e.importTrace))},"patchErrorWithTrace"),T=n(()=>{const e=new Map,r=n(t=>t.id??t.loc?.file,"getErrorFile"),c=n(t=>{const i=[];let s=t;const o=new Set;for(;s&&!o.has(s);)o.add(s),i.unshift(s),s=e.get(s);return i},"getTrace"),a=n((t,i=new Set)=>{if(!t?.id||i.has(t.id))return[];if(i.add(t.id),t.importers.size===0)return[t.id];const s=[...t.importers][0];return[...a(s,i),t.id]},"getViteTrace");return{name:"import-trace",configureServer(t){return()=>{t.middlewares.use((i,s,o,g)=>{const p=r(i);if(p){const u=t.moduleGraph.getModuleById(p),d=a(u);d.length>1&&(i.message+=m(d))}g(i)})}},buildStart:n(()=>{e.clear()},"buildStart"),moduleParsed(t){for(const i of t.importedIds)e.has(i)||e.set(i,t.id);for(const i of t.dynamicallyImportedIds)e.has(i)||e.set(i,t.id)},buildEnd(t){if(!t)return;const i=r(t);if(i){const s=c(i);s.length>1&&(t.importTrace=s)}}}},"importTrace");export{T as importTrace,h as patchErrorWithTrace};
