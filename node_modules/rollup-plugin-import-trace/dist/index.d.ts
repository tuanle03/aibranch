import { RollupError, Plugin } from 'rollup';

/**
 * Rollup error with import trace property
 */
type RollupErrorWithTrace = RollupError & {
    importTrace?: string[];
};
/**
 * Vite module from moduleGraph
 */
type ViteModule = {
    id: string | null;
    importers: Set<ViteModule>;
};
/**
 * Vite dev server (minimal type for what we need)
 */
type ViteDevServer = {
    moduleGraph: {
        getModuleById: (id: string) => ViteModule | undefined;
    };
    middlewares: {
        use: (handler: ViteErrorMiddleware) => void;
    };
};
/**
 * Vite/Connect error middleware signature
 */
type ViteErrorMiddleware = (error: RollupErrorWithTrace, request: unknown, response: unknown, next: (error?: unknown) => void) => void;
type RollupVitePlugin = Plugin & {
    configureServer?: (server: ViteDevServer) => (() => void) | void;
};
/**
 * Patches an error's message with its import trace.
 * Reads the `importTrace` property and appends a formatted trace to the message.
 */
declare const patchErrorWithTrace: (error: unknown) => void;
/**
 * Creates a Rollup/Vite plugin that automatically appends import traces to build errors.
 *
 * When a build error occurs, the error message is enhanced with the full import chain
 * showing how the problematic module was reached from the entry point.
 *
 * @example
 * ```ts
 * import { rollup } from 'rollup';
 * import { importTrace } from 'rollup-plugin-import-trace';
 *
 * // Errors automatically include import trace
 * await rollup({ input: 'src/index.js', plugins: [importTrace()] });
 * ```
 *
 * @example
 * ```ts
 * // vite.config.ts
 * import { defineConfig } from 'vite';
 * import { importTrace } from 'rollup-plugin-import-trace';
 *
 * export default defineConfig({
 *   plugins: [importTrace()],
 * });
 * ```
 */
declare const importTrace: () => RollupVitePlugin;

export { importTrace, patchErrorWithTrace };
export type { RollupErrorWithTrace };
